<div class="register-container">
      <mat-card class="register-card">
        <mat-card-header>
          <mat-card-title>
            <h1>MoneyFlowTracker</h1>
          </mat-card-title>
          <mat-card-subtitle>Zresetuj hasło</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()">
            @if (errorMessage()) {
              <div class="error-message" data-testid="register-error-message">
                <mat-icon>error</mat-icon>
                <span>{{ errorMessage() }}</span>
              </div>
            }

            @if (successMessage()) {
              <div class="success-message" data-testid="register-success-message">
                <mat-icon>check_circle</mat-icon>
                <span>{{ successMessage() }}</span>
              </div>
            }

            <mat-form-field appearance="outline">
              <mat-label>Hasło</mat-label>
              <input
                matInput
                [type]="hidePassword() ? 'password' : 'text'"
                formControlName="password"
                placeholder="Minimum 6 znaków"
                autocomplete="new-password"
                data-testid="register-password-input" />
              <button
                mat-icon-button
                matSuffix
                type="button"
                (click)="hidePassword.set(!hidePassword())"
                [attr.aria-label]="'Hide password'"
                [attr.aria-pressed]="hidePassword()">
                <mat-icon>{{ hidePassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              @if (
                resetPasswordForm.get('password')?.hasError('required') &&
                resetPasswordForm.get('password')?.touched
              ) {
                <mat-error>Hasło jest wymagane</mat-error>
              }
              @if (
                resetPasswordForm.get('password')?.hasError('minlength') &&
                resetPasswordForm.get('password')?.touched
              ) {
                <mat-error>Hasło musi zawierać co najmniej 6 znaków</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Powtórz hasło</mat-label>
              <input
                matInput
                [type]="hideConfirmPassword() ? 'password' : 'text'"
                formControlName="confirmPassword"
                placeholder="Wprowadź hasło ponownie"
                autocomplete="new-password"
                data-testid="register-confirm-password-input" />
              <button
                mat-icon-button
                matSuffix
                type="button"
                (click)="hideConfirmPassword.set(!hideConfirmPassword())"
                [attr.aria-label]="'Hide confirm password'"
                [attr.aria-pressed]="hideConfirmPassword()">
                <mat-icon>{{ hideConfirmPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              @if (
                resetPasswordForm.get('confirmPassword')?.hasError('required') &&
                resetPasswordForm.get('confirmPassword')?.touched
              ) {
                <mat-error>Potwierdzenie hasła jest wymagane</mat-error>
              }
              @if (
                resetPasswordForm.hasError('passwordMismatch') &&
                resetPasswordForm.get('confirmPassword')?.touched
              ) {
                <mat-error>Hasła nie są identyczne</mat-error>
              }
            </mat-form-field>

            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="resetPasswordForm.invalid || loading()"
              class="submit-button"
              data-testid="register-submit-button">       
                <span>Zresetuj hasło</span>              
            </button>
          </form>
        </mat-card-content>

        <mat-card-actions>
          <p class="login-link">
            Masz już konto?
            <a routerLink="/login" data-testid="register-login-link">Zaloguj się</a>
          </p>
        </mat-card-actions>
      </mat-card>
    </div>