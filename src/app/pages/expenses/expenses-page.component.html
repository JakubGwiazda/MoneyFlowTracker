<div class="expenses-page-container d-flex flex-column" style="height: calc(100vh - 200px)">
  <div class="tab-content mt-2 mb-2 flex-shrink-0">
    <mat-card>
      <mat-expansion-panel
        class="filters-expansion-panel"
        [expanded]="filtersExpanded()"
        (expandedChange)="onFiltersPanelExpandedChange($event)">
        <mat-expansion-panel-header>
          <mat-panel-title> Filtry wyszukiwania </mat-panel-title>
          <mat-panel-description> Kliknij aby rozwinąć/zwinąć filtry </mat-panel-description>
        </mat-expansion-panel-header>

        <app-expenses-filters
          [value]="vm().filters"
          [loading]="vm().loading"
          [categories]="categoryOptions()"
          (filterChange)="onFilterChange($event)"
          (categorySearch)="onCategorySearch($event)" />
      </mat-expansion-panel>
    </mat-card>
    <div class="actions-section mt-3 mb-2">
      <button
        mat-raised-button
        color="primary"
        type="button"
        (click)="onAddExpense()"
        class="flex items-center gap-2 me-3"
        data-testid="add-expense-button">
        <mat-icon>add</mat-icon>
        Dodaj pozycję
      </button>
      @if (hasSelection()) {
        <button
          mat-raised-button
          color="accent"
          type="button"
          (click)="onMassEditCategory()"
          class="flex items-center gap-2"
          data-testid="mass-edit-button">
          <mat-icon>edit</mat-icon>
          Edytuj wiele ({{ selectedExpenseIds().length }})
        </button>
      }
    </div>
    <div>Kwota pozycji na stronie: {{ summaryAmount() }} PLN</div>
  </div>
  <div class="table-container flex-grow-1 overflow-auto">
    <app-expenses-table
      [data]="vm().expenses"
      [loading]="vm().loading"
      [sortState]="vm().sort"
      [filtersExpanded]="filtersExpanded()"
      (sortChange)="onSortChange($event)"
      (selectionChange)="onSelectionChange($event)"
      (editExpense)="onEditExpense($event)"
      (deleteExpense)="onDeleteExpense($event)" />
  </div>

  <div class="pagination-container flex-shrink-0">
    <app-pagination-controls
      [state]="vm().pagination"
      [disabled]="vm().loading"
      (pageChange)="onPageChange($event)"
      (perPageChange)="onPerPageChange($event)" />
  </div>
</div>
